# GIS-recommendation
ì§€ë¦¬ê¸°ë°˜ ë§›ì§‘ ì¶”ì²œ ì›¹ ì„œë¹„ìŠ¤

## ê°œë°œ ê¸°ê°„
2023.10.31 ~ 2023.11.10

## ëª©ì°¨
1. [í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­](#í”„ë¡œì íŠ¸-ìš”êµ¬ì‚¬í•­)
   1. [ìœ ì € ìŠ¤í† ë¦¬](#ìœ ì €-ìŠ¤í† ë¦¬)
   2. [ë‹´ë‹¹ ì—­í• ](#ë‹´ë‹¹-ì—­í• ) 
2. [Study](#Study)
   1. [ìš”êµ¬ì‚¬í•­](#ìš”êµ¬ì‚¬í•­)
   2. [ì˜ˆìƒ](#ì˜ˆìƒ)
   3. [ìƒí™©](#ìƒí™©)
   4. [ì„ íƒ](#ì„ íƒ)
   5. [íŠ¸ëŸ¬ë¸” ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…)
      1. [ë¬¸ì œ](#ë¬¸ì œ)
      2. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
   6. [trade off](#trade-off)
   7. [ì¶”ê°€ ë‚´ìš©](#ì¶”ê°€-ë‚´ìš©)
   8. [ë‚™ê´€ì  ë½ ì‚¬ìš©ì‹œ ë°ë“œë½ ë°œìƒ](#ë‚™ê´€ì -ë½-ì‚¬ìš©ì‹œ-ë°ë“œë½-ë°œìƒ)
   9. [ë¹„ê´€ì  ë½ ì‚¬ìš©ì‹œ](#ë¹„ê´€ì -ë½-ì‚¬ìš©ì‹œ)

## í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­
[ğŸ£ì§€ë¦¬ê¸°ë°˜ ë§›ì§‘ ì¶”ì²œ ì›¹ ì„œë¹„ìŠ¤ ìš”êµ¬ì‚¬í•­](https://hyerijang.notion.site/ed13c3afee524dc38a6a86a29489a75e?pvs=4)

### ìœ ì € ìŠ¤í† ë¦¬
- ìœ ì €ëŠ” ë³¸ ì‚¬ì´íŠ¸ì— ë“¤ì–´ì™€ íšŒì›ê°€ì… ë° ë‚´ ìœ„ì¹˜ë¥¼ ì§€ì •í•œë‹¤.
- **A. ë‚´ ìœ„ì¹˜ ê¸°ë°˜ ë§›ì§‘ì¶”ì²œ = (`ë‚´ ì£¼ë³€ë³´ê¸°`)**
    - `ë„ë³´` ê¸°ì¤€ `1km` ì´ë‚´ì˜ ë§›ì§‘ì„ ì¶”ì²œí•œë‹¤.
    - `êµí†µìˆ˜ë‹¨` ê¸°ì¤€ `5km` ì´ë‚´ì˜ ë§›ì§‘ì„ ì¶”ì²œí•œë‹¤.
- **B. ì§€ì—­ëª… ê¸°ì¤€ ë§›ì§‘ì¶”ì²œ(`íŠ¹ì • ì§€ì—­ ë³´ê¸°`)**
    - ì§€ì •í•œ `ì§€ëª…(ì‹œêµ°êµ¬)` ì¤‘ì‹¬ìœ„ì¹˜ ê¸°ì¤€ `10km` ì´ë‚´ì˜ ë§›ì§‘ì„ ì¶”ì²œí•œë‹¤.
- **C. ì ì‹¬ ì¶”ì²œ ì„œë¹„ìŠ¤**
    - ì ì‹¬ ì¶”ì²œ ì„œë¹„ìŠ¤ ì´ìš©ì„ ìŠ¹ë½í•œ ëŒ€ìƒì—ê²Œ ë§¤ì¼ ì •ì˜¤, ëŒ€ìƒì˜ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì›í•˜ëŠ” ìœ í˜•(ì¼ì‹, ì¤‘ì‹ ë“±)ì˜ ê°€ê²Œë¥¼ 3ê°œì”© ì¶”ì²œ í•´ì¤€ë‹¤.
- A, BëŠ” ë‹¤ì–‘í•œ ê²€ìƒ‰ê¸°ì¤€ (ì •ë ¬, í•„í„°ë§ ë“±)ìœ¼ë¡œ ì¡°íšŒ ê°€ëŠ¥í•˜ë©° (`ê±°ë¦¬ìˆœ`, `í‰ì ìˆœ` , `ì–‘ì‹`, `ì¤‘ì‹`)
- í•´ë‹¹ ë§›ì§‘ì˜ ìƒì„¸ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### ë‹´ë‹¹ ì—­í• 
<table>
    <tr>
        <td><B>íŒ€ì›</B></td>
        <td><B>ìš”êµ¬ ì‚¬í•­</B></td>
        <td><B>ìš”êµ¬ ì‚¬í•­ ìƒì„¸</B></td>
    </tr>
    <tr>
        <td>ë¬¸ì±„ì˜</td>
        <td>ë§›ì§‘ ì¡°íšŒ</td>
        <td>ë§›ì§‘ ì¡°íšŒ, ì‹œêµ°êµ¬ ëª©ë¡, ë§›ì§‘ ìƒì„¸ì •ë³´</td>
    </tr>
    <tr>
        <td>ê¶Œìˆœí•œ</td>
        <td>ë°ì´í„° íŒŒì´í”„ë¼ì¸</td>
        <td>ë°ì´í„° ìˆ˜ì§‘, ì „ì²˜ë¦¬, ì €ì¥, ìë™í™”</td>
    </tr>
    <tr>
        <td>ê¹€ì‹œì€</td>
        <td>ì‚¬ìš©ì</td>
        <td>ì‚¬ìš©ì íšŒì›ê°€ì…, ë¡œê·¸ì¸, ì„¤ì • ì—…ë°ì´íŠ¸, ì •ë³´ ì¡°íšŒ</td>
    </tr>
    <tr>
        <td>ì •ì§€ì›</td>
        <td>í‰ê°€</td>
        <td>í‰ê°€ ëª¨ë¸ë§, í‰ê°€ ìƒì„±</td>
    </tr>
</table>

## Study
- ë‹´ë‹¹ ë¶„ëŸ‰ì˜ ë³¼ë¥¨ì´ ì‘ì•„ì„œ, íŒ€ì›ê³¼ ì´ì•¼ê¸°ë¥¼ í•œ í›„ì— Database Lockì— ëŒ€í•´ì„œ ìŠ¤í„°ë””í•˜ê³  ê²°ê³¼ë¥¼ ê³µìœ í•˜ì˜€ìŠµë‹ˆë‹¤.
### ìš”êµ¬ì‚¬í•­
- ìš”êµ¬ì‚¬í•­ ì“°ê¸° !!@!@!@!@!@
### ì˜ˆìƒ 
- ë‘ ê°œì˜ í…Œì´ë¸”ì„ ìˆ˜ì •í•´ì•¼ í•˜ê¸° ë–„ë¬¸ì— ë°ì´í„° `ì •í•©ì„± ë¬¸ì œ`ê°€ ë°œìƒí•  ê²ƒì´ë¼ê³  ì˜ˆìƒ í•˜ì˜€ìŠµë‹ˆë‹¤.
- ë°ì´í„° ì •í•©ì„±ì„ ì§€í‚¤ê¸°ìœ„í•´ì„œ `Lock`ì„ ì‚¬ìš©í•´ì•¼ê² ë‹¤ê³  ìƒê°í•˜ì˜€ìŠµë‹ˆë‹¤.
### ìƒí™©
- ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ê°€ `ê²½ê¸°ë„` ì¸ì , ë„¤ì´ë²„ì˜ ê°•ë‚¨ì—­ì˜ ìŒì‹ì  ë¦¬ë·°ë„ ìŒì‹ì  ë³„ `ì¼ë‹¹ ìµœëŒ€ 10ê°œ`ê°€ ë„˜ëŠ” ê³³ì„ ì°¾ì•„ ë³¼ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.
- í˜„ì‹¤ì ìœ¼ë¡œ ëŒ€ì´í„° ì •í•©ì„±ì„ ì§€í‚¬ ìˆ˜ ì—†ëŠ” ê²½ìš°ê°€ `ê±°ì˜ ì—†ì„ ê²ƒ`ì´ë¼ê³  ì˜ˆìƒí•˜ì˜€ìŠµë‹ˆë‹¤.
### ì„ íƒ
- `ë‚™ê´€ì  ë½`ì„ ì‚¬ìš©í•˜ë©´ì„œ, ì‹¤íŒ¨ í›„ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ `AOPë¡œ ì¬ì‹œë„`ë¥¼ í•˜ëŠ” ì„ íƒì„ í•˜ì˜€ìŠµë‹ˆë‹¤.
### íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
#### ë¬¸ì œ
- `ë‚™ê´€ì  ë½`ì„ ì‚¬ìš©í•˜ê³  ë‚˜ì„œ í…ŒìŠ¤íŠ¸ê°€ `í™•ë¥ ì `ìœ¼ë¡œ `ì‹¤íŒ¨`í•˜ì˜€ìŠµë‹ˆë‹¤.
  <img width="488" alt="Screenshot 2023-12-07 at 4 29 47â€¯PM" src="https://github.com/Preonboarding-I-Team/GIS-recommendation/assets/115606959/f9d12ba3-f9ff-4cab-a9ca-0270a647ef85">
  <img width="488" alt="Screenshot 2023-12-07 at 4 29 57â€¯PM" src="https://github.com/Preonboarding-I-Team/GIS-recommendation/assets/115606959/daf11e7f-636e-4647-9919-693116dc5fc4">
- í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ `2ê°€ì§€` ì˜€ìŠµë‹ˆë‹¤.
  1. `version`ì´ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°
     <img width="600" alt="Screenshot 2023-12-07 at 4 37 56â€¯PM" src="https://github.com/Preonboarding-I-Team/GIS-recommendation/assets/115606959/78421f98-c882-4204-acc8-2aa4de3fc006">
     <img width="600" alt="Screenshot 2023-12-07 at 4 37 53â€¯PM" src="https://github.com/Preonboarding-I-Team/GIS-recommendation/assets/115606959/1673d480-29e4-44ca-9f06-44ada6eae6d1">
  2. `rating`ì´ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°
     <img width="600" alt="Screenshot 2023-12-07 at 4 37 50â€¯PM" src="https://github.com/Preonboarding-I-Team/GIS-recommendation/assets/115606959/6a819ccd-921f-43cd-b49b-4804ee11c459">
#### ë¬¸ì œ í•´ê²°
- mysqlì˜ ë¡œê·¸ë¥¼ ì‚´í´ë³´ë‹ˆ íŠ¹ì • ìƒí™©ì—ì„œ `update` ì¿¼ë¦¬ê°€ `ëˆ„ë½`ëœë‹¤ëŠ” ê²ƒì´ í™•ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤.
  <details>
  <summary>[í´ë¦­] MySQL ë¡œê·¸ ë³´ê¸°</summary>
  
  - ë°ì´í„° init
  ```
  2023-12-07T07:41:27.524828Z       130 Query     SET autocommit=0
  2023-12-07T07:41:27.545127Z       130 Query     insert into user (latitude, longitude, lunch_service, password, role, username) values ('lat#1', 'log#1', 0, 'password#1', 'MEMBER', 'username#1')
  2023-12-07T07:41:27.564938Z       130 Query     commit
  2023-12-07T07:41:27.574094Z       130 Query     SET autocommit=1
  2023-12-07T07:41:27.577547Z       130 Query     SET autocommit=0
  2023-12-07T07:41:27.585251Z       130 Query     insert into store (bizplc_nm, bsn_state_nm, bsnsite_circumfr_div_nm, clsbiz_de, female_enflpsn_cnt, grad_div_nm, grad_faclt_div_nm, licensg_de, locplc_ar, male_enflpsn_cnt, multi_use_bizestbl_yn, rating, refine_lotno_addr, refine_roadnm_addr, refine_wgs84lat, refine_wgs84logt, refine_zip_cd, sanittn_bizcond_nm, sanittn_indutype_nm, sigun_nm, store_id, tot_emply_cnt, tot_faclt_scale, version, yy) values ('no info', 'no info', 'no info', 'open', 0, 'no info', 'no info', '2016-08-26', 0.0, 0, 'no info', 0.0, 'no info', 'no info', 0.0, 0.0, 'no info', 'no info', 'no info', 'no info', 'nullnull', 0.0, 0.0, 0, 0)
  ```
  - í…ŒìŠ¤íŠ¸ ì‹œì‘
  - ë°ì´í„° ì¡°íšŒ
  ```
  2023-12-07T07:41:27.590108Z       130 Query     commit
  2023-12-07T07:41:27.592144Z       130 Query     SET autocommit=1
  2023-12-07T07:41:27.599145Z       130 Query     SET autocommit=0
  2023-12-07T07:41:27.599866Z       134 Query     SET autocommit=0
  2023-12-07T07:41:27.599866Z       133 Query     SET autocommit=0
  2023-12-07T07:41:27.599866Z       132 Query     SET autocommit=0
  2023-12-07T07:41:27.599873Z       131 Query     SET autocommit=0
  2023-12-07T07:41:27.652336Z       132 Query     select ...
  2023-12-07T07:41:27.653604Z       131 Query     select ...
  2023-12-07T07:41:27.653705Z       134 Query     select ...
  2023-12-07T07:41:27.654570Z       133 Query     select ...
  2023-12-07T07:41:27.654918Z       130 Query     select ...
  ```
  - ë¦¬ë·° ë“±ë¡
  ```
  2023-12-07T07:41:27.666595Z       132 Query     insert into review ...
  2023-12-07T07:41:27.666595Z       131 Query     insert into review ...
  2023-12-07T07:41:27.666595Z       130 Query     insert into review ...
  2023-12-07T07:41:27.666604Z       134 Query     insert into review ...
  2023-12-07T07:41:27.666605Z       133 Query     insert into review ...
  ```
  - update ì¿¼ë¦¬
  ```
  2023-12-07T07:41:27.673800Z       134 Query     update store set ...
  2023-12-07T07:41:27.673800Z       133 Query     update store set ...
  2023-12-07T07:41:27.673813Z       132 Query     update store set ...
  2023-12-07T07:41:27.673830Z       130 Query     update store set ...
  2023-12-07T07:41:27.674011Z       131 Query     update store set ...
  ```
  - ì²«ë²ˆì§¸ ì„±ê³µ (ì»¤ë°‹ 1, ë¡¤ë°± 4)
  ```
  2023-12-07T07:41:27.679164Z       134 Query     commit
  2023-12-07T07:41:27.681132Z       134 Query     SET autocommit=1
  2023-12-07T07:41:27.684122Z       131 Query     rollback
  2023-12-07T07:41:27.684138Z       133 Query     rollback
  2023-12-07T07:41:27.684143Z       130 Query     rollback
  2023-12-07T07:41:27.684154Z       132 Query     rollback
  2023-12-07T07:41:27.684644Z       131 Query     SET autocommit=1
  2023-12-07T07:41:27.684861Z       133 Query     SET autocommit=1
  2023-12-07T07:41:27.684873Z       130 Query     SET autocommit=1
  2023-12-07T07:41:27.684874Z       132 Query     SET autocommit=1
  2023-12-07T07:41:27.686598Z       131 Query     SET autocommit=0
  2023-12-07T07:41:27.686598Z       133 Query     SET autocommit=0
  2023-12-07T07:41:27.686600Z       130 Query     SET autocommit=0
  2023-12-07T07:41:27.686603Z       132 Query     SET autocommit=0
  ```
  - ì¡°íšŒ - 2ë²ˆì§¸ ì‹œë„
  ```
  2023-12-07T07:41:27.689794Z       131 Query     select ...
  2023-12-07T07:41:27.689795Z       132 Query     select ...
  2023-12-07T07:41:27.689802Z       130 Query     select ...
  2023-12-07T07:41:27.690068Z       133 Query     select ...
  ```
  - ë¦¬ë·° ë“±ë¡ - 2ë²ˆì§¸ ì‹œë„
  ```
  2023-12-07T07:41:27.696149Z       130 Query     insert into review ...
  2023-12-07T07:41:27.696197Z       131 Query     insert into review ...
  2023-12-07T07:41:27.696175Z       132 Query     insert into review ...
  2023-12-07T07:41:27.696149Z       133 Query     insert into review ...
  ```
  - **ì»¤ë°‹ ?**
  ```
  2023-12-07T07:41:27.697675Z       131 Query     commit
  ```
  - update ì¿¼ë¦¬ - 2ë²ˆì§¸ ì‹œë„
  ```
  2023-12-07T07:41:27.698779Z       133 Query     update store set ...
  2023-12-07T07:41:27.698799Z       132 Query     update store set ...
  2023-12-07T07:41:27.698959Z       130 Query     update store set ...
  ```
  - **ë‘ë²ˆì§¸ ì„±ê³µ (ì»¤ë°‹ 1, ë¡¤ë°±2) ?**
  ```
  2023-12-07T07:41:27.700175Z       131 Query     SET autocommit=1
  2023-12-07T07:41:27.700689Z       132 Query     commit
  2023-12-07T07:41:27.701499Z       133 Query     rollback
  2023-12-07T07:41:27.701632Z       130 Query     rollback
  2023-12-07T07:41:27.702284Z       133 Query     SET autocommit=1
  2023-12-07T07:41:27.702427Z       130 Query     SET autocommit=1
  2023-12-07T07:41:27.703652Z       132 Query     SET autocommit=1
  2023-12-07T07:41:27.703725Z       133 Query     SET autocommit=0
  2023-12-07T07:41:27.703743Z       130 Query     SET autocommit=0
  ```
  - ì¡°íšŒ - 3ë²ˆì§¸ ì‹œë„
  ```
  2023-12-07T07:41:27.705993Z       133 Query     select ...
  2023-12-07T07:41:27.706004Z       130 Query     select ...
  ```
  - ë¦¬ë·° ë“±ë¡ - 3ë²ˆì§¸ ì‹œë„
  ```
  2023-12-07T07:41:27.708858Z       130 Query     insert into review ...
  2023-12-07T07:41:27.708858Z       133 Query     insert into review ...
  ```
  - ì»¤ë°‹ ?: update ì¿¼ë¦¬ ì—†ìŒ
  ```
  2023-12-07T07:41:27.709958Z       133 Query     commit
  ```
  - update ì¿¼ë¦¬
  ```
  2023-12-07T07:41:27.710527Z       130 Query     update store set ...
  ```
  - 3ë²ˆì§¸ ì„±ê³µ
  ```
  2023-12-07T07:41:27.712002Z       133 Query     SET autocommit=1
  2023-12-07T07:41:27.712027Z       130 Query     commit
  2023-12-07T07:41:27.713922Z       130 Query     SET autocommit=1
  ```
  - ê²€ì¦ ì¡°íšŒ ()
  ```
  2023-12-07T07:41:27.716072Z       130 Query     set session transaction read only
  2023-12-07T07:41:27.716706Z       130 Query     SET autocommit=0
  2023-12-07T07:41:27.723221Z       130 Query     select ...
  2023-12-07T07:41:27.725084Z       130 Query     commit
  2023-12-07T07:41:27.725686Z       130 Query     SET autocommit=1
  2023-12-07T07:41:27.726263Z       130 Query     set session transaction read write
  2023-12-07T07:41:27.787975Z       130 Quit
  2023-12-07T07:41:27.788091Z       138 Quit
  2023-12-07T07:41:27.788161Z       133 Quit
  2023-12-07T07:41:27.788172Z       137 Quit
  2023-12-07T07:41:27.788198Z       135 Quit
  2023-12-07T07:41:27.788211Z       139 Quit
  2023-12-07T07:41:27.788224Z       134 Quit
  2023-12-07T07:41:27.788282Z       136 Quit
  2023-12-07T07:41:27.788292Z       131 Quit
  2023-12-07T07:41:27.788301Z       132 Quit
  ```
  </details>

- ê°’ì„ ì¶”ì í•´ë³´ë‹ˆ `store`ì—ì„œ `rating`ì˜ ê°’ì´ ë³€í•˜ì§€ ì•Šìœ¼ë©´(ex: 3.0 -> 3.0) `dirty checking`ì´ ì¼ì–´ë‚˜ì§€ ì•Šì•„ `update` í•˜ì§€ ì•ŠëŠ” ìƒí™©ì´ì—ˆìŠµë‹ˆë‹¤.
- `version`ê°’ì„ ë³€ê²½í•˜ì—¬ ì–´ë–¤ ìƒí™©ì—ì„œë„ `update`ê°€ ë°œìƒí•˜ë„ë¡ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.
### trade off
- ì—…ë°ì´íŠ¸ê°€ í•„ìš” ì—†ëŠ” ìƒí™©ì—ì„œë„ ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.
- ë°ì´í„°ì˜ ì •í•©ì„±ì„ ì§€í‚¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
### ì¶”ê°€ ë‚´ìš©
#### ë‚™ê´€ì  ë½ ì‚¬ìš©ì‹œ ë°ë“œë½ ë°œìƒ
- mysql ë¡œê·¸ë¥¼ ì‚´í´ë³´ë˜ì¤‘ ë°ë“œë½ ë°œìƒìœ¼ë¡œ `version`ì˜ ê°’ì´ ë‹¬ë¼ì„œ `update`ê°€ ì•ˆëœë‹¤ê¸° ë³´ë‹¤ëŠ” `deadlock` ë°œìƒìœ¼ë¡œ ì—…ë°ì´íŠ¸ê°€ ì•ˆë˜ëŠ” ê²ƒì´ í™•ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤.
  - ë°ë“œë½ ë¡œê·¸
    - ë‚´ìš© ìš”ì•½
      - tx1: s lock íšë“
      - tx1: x lock íšë“ ëŒ€ê¸°
      - tx2: s lock íšë“
      - tx2: x lock íšë“ ëŒ€ê¸° ( -> deadlock )
      - tx2 -> rollback ê²°ì •
  - ë¡œê·¸
    ```
    ------------------------
    LATEST DETECTED DEADLOCK
    ------------------------
    2023-11-05 13:45:37 281473153331008
    *** (1) TRANSACTION:
    TRANSACTION 101016, ACTIVE 0 sec starting index read
    mysql tables in use 1, locked 1
    LOCK WAIT 7 lock struct(s), heap size 1128, 3 row lock(s), undo log entries 1
    MySQL thread id 918, OS thread handle 281473098747712, query id 14182 172.17.0.1 hello updating
    update store set bizplc_nm='no info', bsn_state_nm='no info', bsnsite_circumfr_div_nm='no info', clsbiz_de='open', female_enflpsn_cnt=0, grad_div_nm='no info', grad_faclt_div_nm='no info', licensg_de='2016-08-26', locplc_ar=0.0, male_enflpsn_cnt=0, multi_use_bizestbl_yn='no info', rating=3.0, refine_lotno_addr='no info', refine_roadnm_addr='no info', refine_wgs84lat=0.0, refine_wgs84logt=0.0, refine_zip_cd='no info', sanittn_bizcond_nm='no info', sanittn_indutype_nm='no info', sigun_nm='no info', store_id='nullnull', tot_emply_cnt=0.0, tot_faclt_scale=0.0, version=4, yy=0 where id=1 and version=3
    
    *** (1) HOLDS THE LOCK(S):
    RECORD LOCKS space id 1922 page no 4 n bits 72 index PRIMARY of table `mysql-db`.`store` trx id 101016 lock mode S locks rec but not gap
    Record lock, heap no 2 PHYSICAL RECORD: n_fields 28; compact format; info bits 0
     0: len 8; hex 8000000000000001; asc         ;;
     1: len 6; hex 000000018a94; asc       ;;
     2: len 7; hex 020000018f0151; asc       Q;;
     3: len 7; hex 6e6f20696e666f; asc no info;;
     4: len 7; hex 6e6f20696e666f; asc no info;;
     5: len 7; hex 6e6f20696e666f; asc no info;;
     6: len 4; hex 6f70656e; asc open;;
     7: len 4; hex 80000000; asc     ;;
     8: len 7; hex 6e6f20696e666f; asc no info;;
     9: len 7; hex 6e6f20696e666f; asc no info;;
     10: len 3; hex 8fc11a; asc    ;;
     11: len 8; hex 0000000000000000; asc         ;;
     12: len 4; hex 80000000; asc     ;;
     13: len 7; hex 6e6f20696e666f; asc no info;;
     14: len 8; hex 0000000000000840; asc        @;;
     15: len 7; hex 6e6f20696e666f; asc no info;;
     16: len 7; hex 6e6f20696e666f; asc no info;;
     17: len 8; hex 0000000000000000; asc         ;;
     18: len 8; hex 0000000000000000; asc         ;;
     19: len 7; hex 6e6f20696e666f; asc no info;;
     20: len 7; hex 6e6f20696e666f; asc no info;;
     21: len 7; hex 6e6f20696e666f; asc no info;;
     22: len 7; hex 6e6f20696e666f; asc no info;;
     23: len 8; hex 6e756c6c6e756c6c; asc nullnull;;
     24: len 8; hex 0000000000000000; asc         ;;
     25: len 8; hex 0000000000000000; asc         ;;
     26: len 4; hex 80000003; asc     ;;
     27: len 4; hex 80000000; asc     ;;
    
    
    *** (1) WAITING FOR THIS LOCK TO BE GRANTED:
    RECORD LOCKS space id 1922 page no 4 n bits 72 index PRIMARY of table `mysql-db`.`store` trx id 101016 lock_mode X locks rec but not gap waiting
    Record lock, heap no 2 PHYSICAL RECORD: n_fields 28; compact format; info bits 0
     0: len 8; hex 8000000000000001; asc         ;;
     1: len 6; hex 000000018a94; asc       ;;
     2: len 7; hex 020000018f0151; asc       Q;;
     3: len 7; hex 6e6f20696e666f; asc no info;;
     4: len 7; hex 6e6f20696e666f; asc no info;;
     5: len 7; hex 6e6f20696e666f; asc no info;;
     6: len 4; hex 6f70656e; asc open;;
     7: len 4; hex 80000000; asc     ;;
     8: len 7; hex 6e6f20696e666f; asc no info;;
     9: len 7; hex 6e6f20696e666f; asc no info;;
     10: len 3; hex 8fc11a; asc    ;;
     11: len 8; hex 0000000000000000; asc         ;;
     12: len 4; hex 80000000; asc     ;;
     13: len 7; hex 6e6f20696e666f; asc no info;;
     14: len 8; hex 0000000000000840; asc        @;;
     15: len 7; hex 6e6f20696e666f; asc no info;;
     16: len 7; hex 6e6f20696e666f; asc no info;;
     17: len 8; hex 0000000000000000; asc         ;;
     18: len 8; hex 0000000000000000; asc         ;;
     19: len 7; hex 6e6f20696e666f; asc no info;;
     20: len 7; hex 6e6f20696e666f; asc no info;;
     21: len 7; hex 6e6f20696e666f; asc no info;;
     22: len 7; hex 6e6f20696e666f; asc no info;;
     23: len 8; hex 6e756c6c6e756c6c; asc nullnull;;
     24: len 8; hex 0000000000000000; asc         ;;
     25: len 8; hex 0000000000000000; asc         ;;
     26: len 4; hex 80000003; asc     ;;
     27: len 4; hex 80000000; asc     ;;
    
    
    *** (2) TRANSACTION:
    TRANSACTION 101017, ACTIVE 0 sec starting index read
    mysql tables in use 1, locked 1
    LOCK WAIT 7 lock struct(s), heap size 1128, 3 row lock(s), undo log entries 1
    MySQL thread id 916, OS thread handle 281473102974784, query id 14183 172.17.0.1 hello updating
    update store set bizplc_nm='no info', bsn_state_nm='no info', bsnsite_circumfr_div_nm='no info', clsbiz_de='open', female_enflpsn_cnt=0, grad_div_nm='no info', grad_faclt_div_nm='no info', licensg_de='2016-08-26', locplc_ar=0.0, male_enflpsn_cnt=0, multi_use_bizestbl_yn='no info', rating=3.0, refine_lotno_addr='no info', refine_roadnm_addr='no info', refine_wgs84lat=0.0, refine_wgs84logt=0.0, refine_zip_cd='no info', sanittn_bizcond_nm='no info', sanittn_indutype_nm='no info', sigun_nm='no info', store_id='nullnull', tot_emply_cnt=0.0, tot_faclt_scale=0.0, version=4, yy=0 where id=1 and version=3
    
    *** (2) HOLDS THE LOCK(S):
    RECORD LOCKS space id 1922 page no 4 n bits 72 index PRIMARY of table `mysql-db`.`store` trx id 101017 lock mode S locks rec but not gap
    Record lock, heap no 2 PHYSICAL RECORD: n_fields 28; compact format; info bits 0
     0: len 8; hex 8000000000000001; asc         ;;
     1: len 6; hex 000000018a94; asc       ;;
     2: len 7; hex 020000018f0151; asc       Q;;
     3: len 7; hex 6e6f20696e666f; asc no info;;
     4: len 7; hex 6e6f20696e666f; asc no info;;
     5: len 7; hex 6e6f20696e666f; asc no info;;
     6: len 4; hex 6f70656e; asc open;;
     7: len 4; hex 80000000; asc     ;;
     8: len 7; hex 6e6f20696e666f; asc no info;;
     9: len 7; hex 6e6f20696e666f; asc no info;;
     10: len 3; hex 8fc11a; asc    ;;
     11: len 8; hex 0000000000000000; asc         ;;
     12: len 4; hex 80000000; asc     ;;
     13: len 7; hex 6e6f20696e666f; asc no info;;
     14: len 8; hex 0000000000000840; asc        @;;
     15: len 7; hex 6e6f20696e666f; asc no info;;
     16: len 7; hex 6e6f20696e666f; asc no info;;
     17: len 8; hex 0000000000000000; asc         ;;
     18: len 8; hex 0000000000000000; asc         ;;
     19: len 7; hex 6e6f20696e666f; asc no info;;
     20: len 7; hex 6e6f20696e666f; asc no info;;
     21: len 7; hex 6e6f20696e666f; asc no info;;
     22: len 7; hex 6e6f20696e666f; asc no info;;
     23: len 8; hex 6e756c6c6e756c6c; asc nullnull;;
     24: len 8; hex 0000000000000000; asc         ;;
     25: len 8; hex 0000000000000000; asc         ;;
     26: len 4; hex 80000003; asc     ;;
     27: len 4; hex 80000000; asc     ;;
    
    
    *** (2) WAITING FOR THIS LOCK TO BE GRANTED:
    RECORD LOCKS space id 1922 page no 4 n bits 72 index PRIMARY of table `mysql-db`.`store` trx id 101017 lock_mode X locks rec but not gap waiting
    Record lock, heap no 2 PHYSICAL RECORD: n_fields 28; compact format; info bits 0
     0: len 8; hex 8000000000000001; asc         ;;
     1: len 6; hex 000000018a94; asc       ;;
     2: len 7; hex 020000018f0151; asc       Q;;
     3: len 7; hex 6e6f20696e666f; asc no info;;
     4: len 7; hex 6e6f20696e666f; asc no info;;
     5: len 7; hex 6e6f20696e666f; asc no info;;
     6: len 4; hex 6f70656e; asc open;;
     7: len 4; hex 80000000; asc     ;;
     8: len 7; hex 6e6f20696e666f; asc no info;;
     9: len 7; hex 6e6f20696e666f; asc no info;;
     10: len 3; hex 8fc11a; asc    ;;
     11: len 8; hex 0000000000000000; asc         ;;
     12: len 4; hex 80000000; asc     ;;
     13: len 7; hex 6e6f20696e666f; asc no info;;
     14: len 8; hex 0000000000000840; asc        @;;
     15: len 7; hex 6e6f20696e666f; asc no info;;
     16: len 7; hex 6e6f20696e666f; asc no info;;
     17: len 8; hex 0000000000000000; asc         ;;
     18: len 8; hex 0000000000000000; asc         ;;
     19: len 7; hex 6e6f20696e666f; asc no info;;
     20: len 7; hex 6e6f20696e666f; asc no info;;
     21: len 7; hex 6e6f20696e666f; asc no info;;
     22: len 7; hex 6e6f20696e666f; asc no info;;
     23: len 8; hex 6e756c6c6e756c6c; asc nullnull;;
     24: len 8; hex 0000000000000000; asc         ;;
     25: len 8; hex 0000000000000000; asc         ;;
     26: len 4; hex 80000003; asc     ;;
     27: len 4; hex 80000000; asc     ;;
    
    *** WE ROLL BACK TRANSACTION (2)
    ```
#### ë¹„ê´€ì  ë½ ì‚¬ìš©ì‹œ
- ë‹¨ìˆœíˆ 5ë²ˆ(í…ŒìŠ¤íŠ¸ Retry íšŸìˆ˜) ì‹¤í–‰ë˜ëŠ” ì†ë„ë§Œ ë¹„êµí•œë‹¤ë©´, `@Retry`ì—ì„œ ì ì‹œ ì‰¬ì–´ì£¼ëŠ” ì‹œê°„ì´ ìˆê¸° ë–„ë¬¸ì— `ë¹„ê´€ì ë½`ì´ ì¢€ ë” ë¹¨ëìŠµë‹ˆë‹¤.
- 1ë²ˆë§Œ ì‹¤í–‰í–ˆì„ ë–„ëŠ” í¬ê²Œ ë‹¤ë¥¼ ì ì´ ì—†ê³ , **ì—¬ì „íˆ ì¶©ëŒì´ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì€ ë‚®ë‹¤ê³  íŒë‹¨**ë˜ì–´ì„œ `ë‚™ê´€ì  ë½`ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
